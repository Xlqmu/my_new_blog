---
// PageBackgroundSwitcher.astro - 全页面背景切换器
---

<div class="page-background-switcher">
    <div class="background-layer" id="background-layer"></div>
</div>

<script>
    function initPageBackgroundSwitcher() {
        const backgroundLayer = document.getElementById(
            "background-layer",
        ) as HTMLDivElement;

        if (!backgroundLayer) return;

        // 设置初始背景
        setBackground("t1.svg");

        // 监听自定义事件
        window.addEventListener("changeBackground", (e: Event) => {
            const customEvent = e as CustomEvent;
            const imageName = customEvent.detail.image;
            setBackground(imageName);
        });

        function setBackground(imageName: string) {
            const newSrc = `/images/hero-images/${imageName}`;

            console.log("尝试设置背景:", newSrc);

            // 添加淡出效果
            backgroundLayer.style.opacity = "0";

            setTimeout(() => {
                backgroundLayer.style.backgroundImage = `url('${newSrc}')`;
                backgroundLayer.style.opacity = "0.3"; // 提高不透明度便于查看
                console.log(
                    "背景已切换到:",
                    imageName,
                    "当前样式:",
                    backgroundLayer.style.backgroundImage,
                );
            }, 300);

            console.log("背景已切换到:", imageName);
        }
    }

    // 初始化
    document.addEventListener("DOMContentLoaded", initPageBackgroundSwitcher);
    if (document.readyState !== "loading") {
        initPageBackgroundSwitcher();
    }
</script>

<style>
    .page-background-switcher {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        pointer-events: none;
    }

    .background-layer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
        opacity: 0.3;
        transition: all 0.5s ease;
    }

    /* 移动端优化 */
    @media (max-width: 768px) {
        .background-layer {
            background-attachment: scroll;
        }
    }

    /* 暗色模式调整 */
    :global(.dark) .background-layer {
        opacity: 0.08;
        filter: brightness(0.6);
    }
</style>
