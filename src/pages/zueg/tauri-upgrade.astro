---
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import Header from "../../components/Header.astro";
import { SITE_TITLE } from "../../consts";
---

<!doctype html>
<html lang="zh-cn">
    <head>
        <BaseHead
            title={`Tauri V2 升级指南 - ${SITE_TITLE}`}
            description="详细介绍如何将Tauri项目从V1升级到V2"
        />
    </head>
    <body>
        <Header />

        <main class="max-w-4xl mx-auto px-4 py-8">
            <div class="mb-8">
                <nav class="text-sm breadcrumbs">
                    <ul class="flex space-x-2 text-gray-600 dark:text-gray-400">
                        <li>
                            <a href="/" class="hover:text-blue-600">首页</a>
                        </li>
                        <li>></li>
                        <li>
                            <a href="/zueg" class="hover:text-blue-600">随笔</a>
                        </li>
                        <li>></li>
                        <li class="text-gray-900 dark:text-white">
                            Tauri V2 升级指南
                        </li>
                    </ul>
                </nav>
            </div>

            <article class="prose dark:prose-invert max-w-none">
                <div class="text-center mb-12">
                    <img
                        src="/images/projects/tauri-image.svg"
                        alt="Tauri V2"
                        class="w-32 h-32 mx-auto mb-6 rounded-lg shadow-lg"
                    />
                    <h1
                        class="text-4xl font-bold text-gray-900 dark:text-white mb-4"
                    >
                        Tauri V2 升级指南
                    </h1>
                    <div
                        class="flex items-center justify-center space-x-4 text-sm text-gray-500 dark:text-gray-400"
                    >
                        <span>📅 2025年8月14日</span>
                        <span>⏱️ 阅读时间 10 分钟</span>
                        <span
                            class="px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full"
                            >软件</span
                        >
                    </div>
                </div>

                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6 mb-8">
                    <h2
                        class="text-xl font-semibold text-blue-900 dark:text-blue-100 mb-3"
                    >
                        📋 本文概要
                    </h2>
                    <p class="text-blue-800 dark:text-blue-200">
                        Tauri V2
                        带来了许多重要的改进和新特性。本文将详细介绍如何将现有的
                        Tauri V1 项目升级到 V2，包括配置变更、API
                        更新以及可能遇到的问题。
                    </p>
                </div>

                <h2>🚀 Tauri V2 的主要新特性</h2>

                <ul>
                    <li>
                        <strong>移动端支持</strong>：现在支持 iOS 和 Android
                        平台
                    </li>
                    <li>
                        <strong>更好的性能</strong>：优化了内存使用和启动速度
                    </li>
                    <li><strong>新的插件系统</strong>：更灵活的插件架构</li>
                    <li>
                        <strong>改进的安全性</strong>：增强的安全模型和权限管理
                    </li>
                    <li>
                        <strong>TypeScript 优先</strong>：更好的 TypeScript 支持
                    </li>
                </ul>

                <h2>🔧 升级准备工作</h2>

                <h3>检查当前版本</h3>
                <p>首先检查当前的工具版本：</p>
                <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-4 mb-4">
                    <p>tauri --version</p>
                    <p>cargo --version</p>
                    <p>node --version</p>
                </div>

                <h3>备份项目</h3>
                <p>在开始升级之前，请确保备份您的项目：</p>
                <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-4 mb-6">
                    <p>git add .</p>
                    <p>git commit -m "备份：升级 Tauri V2 前的状态"</p>
                    <p>git tag v1-backup</p>
                </div>

                <h2>📦 安装 Tauri V2</h2>

                <h3>更新 Tauri CLI</h3>
                <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-4 mb-4">
                    <p># 卸载旧版本</p>
                    <p>cargo uninstall tauri-cli</p>
                    <p># 安装 V2 版本</p>
                    <p>cargo install tauri-cli --version "^2.0"</p>
                </div>

                <h3>更新项目依赖</h3>
                <p>在 src-tauri/Cargo.toml 中更新依赖版本。</p>

                <h2>⚙️ 配置文件更新</h2>

                <h3>tauri.conf.json 变更</h3>
                <p>V2 版本的配置文件结构有一些变化，主要包括：</p>

                <div
                    class="bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 p-4 mb-6"
                >
                    <h4
                        class="text-yellow-800 dark:text-yellow-200 font-semibold mb-2"
                    >
                        ⚠️ 重要变更
                    </h4>
                    <ul class="text-yellow-700 dark:text-yellow-300 space-y-1">
                        <li>• 移除了 tauri.bundle.category</li>
                        <li>• 新增了 app.security 配置</li>
                        <li>• 更新了窗口配置选项</li>
                    </ul>
                </div>

                <h3>示例配置</h3>
                <p>更新后的配置文件示例结构。</p>

                <h2>🔄 API 迁移</h2>

                <h3>导入方式变更</h3>
                <p><strong>V1 导入方式：</strong></p>
                <p>从 @tauri-apps/api/tauri 导入</p>

                <p><strong>V2 导入方式：</strong></p>
                <p>从 @tauri-apps/api/core 导入</p>

                <h3>事件系统更新</h3>
                <p>V2 版本的事件系统更加完善，支持更好的类型检查。</p>

                <h2>🐛 常见问题解决</h2>

                <h3>编译错误</h3>
                <div
                    class="bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4 mb-4"
                >
                    <h4 class="text-red-800 dark:text-red-200 font-semibold">
                        错误：找不到 tauri 模块
                    </h4>
                    <p class="text-red-700 dark:text-red-300 mt-2">
                        <strong>解决方案：</strong>确保已正确安装 V2
                        版本的依赖，并清理缓存
                    </p>
                </div>

                <h3>前端打包问题</h3>
                <div
                    class="bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4 mb-4"
                >
                    <h4 class="text-red-800 dark:text-red-200 font-semibold">
                        错误：CSP 策略阻止执行
                    </h4>
                    <p class="text-red-700 dark:text-red-300 mt-2">
                        <strong>解决方案：</strong>更新 CSP 配置以适应 V2
                        的安全要求。
                    </p>
                </div>

                <h2>✅ 升级完成检查</h2>

                <p>升级完成后，请进行以下检查：</p>

                <div class="space-y-4">
                    <div class="flex items-start space-x-3">
                        <div
                            class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center mt-0.5"
                        >
                            <svg
                                class="w-4 h-4 text-white"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <div>
                            <h4 class="font-semibold">开发模式测试</h4>
                            <p class="text-gray-600 dark:text-gray-400">
                                运行 <code>npm run tauri dev</code> 确保应用正常启动
                            </p>
                        </div>
                    </div>

                    <div class="flex items-start space-x-3">
                        <div
                            class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center mt-0.5"
                        >
                            <svg
                                class="w-4 h-4 text-white"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <div>
                            <h4 class="font-semibold">功能验证</h4>
                            <p class="text-gray-600 dark:text-gray-400">
                                测试所有核心功能是否正常工作
                            </p>
                        </div>
                    </div>

                    <div class="flex items-start space-x-3">
                        <div
                            class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center mt-0.5"
                        >
                            <svg
                                class="w-4 h-4 text-white"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <div>
                            <h4 class="font-semibold">构建测试</h4>
                            <p class="text-gray-600 dark:text-gray-400">
                                运行 <code>npm run tauri build</code> 测试生产构建
                            </p>
                        </div>
                    </div>
                </div>

                <h2>🎉 总结</h2>

                <p>
                    Tauri V2 的升级虽然涉及一些配置和 API
                    的变更，但带来的性能提升和新功能是值得的。
                    通过本指南的步骤，您应该能够顺利完成升级。如果遇到问题，建议查阅
                    <a
                        href="https://tauri.app/v1/guides/migration"
                        target="_blank"
                        rel="noopener noreferrer"
                        class="text-blue-600 dark:text-blue-400 hover:underline"
                        >官方迁移文档</a
                    >
                    或在社区寻求帮助。
                </p>

                <div
                    class="bg-green-50 dark:bg-green-900/20 rounded-lg p-6 mt-8"
                >
                    <h3
                        class="text-green-900 dark:text-green-100 font-semibold mb-2"
                    >
                        💡 升级小贴士
                    </h3>
                    <ul class="text-green-800 dark:text-green-200 space-y-1">
                        <li>• 建议在测试环境中先完成升级验证</li>
                        <li>• 保持 Node.js 和 Rust 工具链为最新版本</li>
                        <li>• 关注 Tauri 官方更新和安全补丁</li>
                        <li>• 考虑使用 Tauri V2 的新特性来增强应用体验</li>
                    </ul>
                </div>
            </article>

            <!-- 相关文章推荐 -->
            <div
                class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700"
            >
                <h3
                    class="text-xl font-semibold text-gray-900 dark:text-white mb-6"
                >
                    相关文章推荐
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <a
                        href="/zueg/git-force-push"
                        class="block p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition"
                    >
                        <h4
                            class="font-semibold text-gray-900 dark:text-white mb-2"
                        >
                            Git Force Push 最佳实践
                        </h4>
                        <p class="text-gray-600 dark:text-gray-400 text-sm">
                            学习如何安全地使用 git force push
                        </p>
                    </a>
                    <a
                        href="/zueg/vue-3-composition-api"
                        class="block p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition"
                    >
                        <h4
                            class="font-semibold text-gray-900 dark:text-white mb-2"
                        >
                            Vue 3 Composition API 深入解析
                        </h4>
                        <p class="text-gray-600 dark:text-gray-400 text-sm">
                            掌握 Vue 3 的核心特性
                        </p>
                    </a>
                </div>
            </div>
        </main>

        <Footer />
    </body>
</html>

<style>
    .prose pre {
        @apply bg-gray-100 dark:bg-gray-900 rounded-lg p-4 overflow-x-auto;
    }

    .prose code {
        @apply bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded text-sm;
    }

    .prose pre code {
        @apply bg-transparent p-0;
    }
</style>
