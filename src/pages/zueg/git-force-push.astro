---
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import Header from "../../components/Header.astro";
import { SITE_TITLE } from "../../consts";
---

<!doctype html>
<html lang="zh-cn">
    <head>
        <BaseHead
            title={`Git Force Push 最佳实践 - ${SITE_TITLE}`}
            description="学习如何安全地使用 git force push"
        />
    </head>
    <body>
        <Header />

        <main class="max-w-4xl mx-auto px-4 py-8">
            <div class="mb-8">
                <nav class="text-sm breadcrumbs">
                    <ul class="flex space-x-2 text-gray-600 dark:text-gray-400">
                        <li>
                            <a href="/" class="hover:text-blue-600">首页</a>
                        </li>
                        <li>></li>
                        <li>
                            <a href="/zueg" class="hover:text-blue-600">随笔</a>
                        </li>
                        <li>></li>
                        <li class="text-gray-900 dark:text-white">
                            Git Force Push 最佳实践
                        </li>
                    </ul>
                </nav>
            </div>

            <article class="prose dark:prose-invert max-w-none">
                <div class="text-center mb-12">
                    <img
                        src="/images/projects/git-image.svg"
                        alt="Git Force Push"
                        class="w-32 h-32 mx-auto mb-6 rounded-lg shadow-lg"
                    />
                    <h1
                        class="text-4xl font-bold text-gray-900 dark:text-white mb-4"
                    >
                        Git Force Push 最佳实践
                    </h1>
                    <div
                        class="flex items-center justify-center space-x-4 text-sm text-gray-500 dark:text-gray-400"
                    >
                        <span>📅 2025年8月14日</span>
                        <span>⏱️ 阅读时间 8 分钟</span>
                        <span
                            class="px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full"
                            >软件</span
                        >
                    </div>
                </div>

                <div
                    class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-6 mb-8"
                >
                    <h2
                        class="text-xl font-semibold text-yellow-900 dark:text-yellow-100 mb-3"
                    >
                        ⚠️ 重要提醒
                    </h2>
                    <p class="text-yellow-800 dark:text-yellow-200">
                        Force push
                        是一个强大但危险的命令。使用不当可能导致代码丢失。本文将教你如何安全地使用这个功能。
                    </p>
                </div>

                <h2>🤔 什么是 Force Push？</h2>
                <p>
                    Force push 是 Git
                    中的一个命令，允许你强制推送本地分支到远程仓库，即使本地和远程的历史记录不匹配。
                    这在某些情况下非常有用，但也可能覆盖其他人的工作。
                </p>

                <h2>🚨 何时需要 Force Push？</h2>
                <ul>
                    <li>
                        <strong>修改提交历史</strong>：使用 rebase 或 commit
                        --amend 后
                    </li>
                    <li><strong>合并提交</strong>：使用 squash 压缩多个提交</li>
                    <li>
                        <strong>修复错误提交</strong>：需要修改已推送的提交信息
                    </li>
                    <li>
                        <strong>清理历史</strong>：重新整理提交历史使其更清晰
                    </li>
                </ul>

                <h2>✅ 安全的 Force Push 方法</h2>

                <h3>1. 使用 --force-with-lease</h3>
                <div
                    class="bg-green-50 dark:bg-green-900/20 border-l-4 border-green-400 p-4 mb-6"
                >
                    <p class="text-green-800 dark:text-green-200">
                        <strong>推荐使用：</strong><code
                            >git push --force-with-lease</code
                        >
                    </p>
                    <p class="text-green-700 dark:text-green-300 mt-2">
                        这个命令比 <code>--force</code> 更安全，因为它会检查远程分支是否被其他人更新过。
                    </p>
                </div>

                <h3>2. 检查工作流程</h3>
                <ol>
                    <li><strong>确认当前分支</strong>：确保你在正确的分支上</li>
                    <li>
                        <strong>拉取最新代码</strong>：<code
                            >git fetch origin</code>
                    </li>
                    <li>
                        <strong>检查差异</strong>：<code
                            >git log --oneline origin/branch..HEAD</code>
                    </li>
                    <li>
                        <strong>安全推送</strong>：<code
                            >git push --force-with-lease origin branch</code>
                    </li>
                </ol>

                <h2>🛡️ 防护措施</h2>

                <h3>团队协作规则</h3>
                <div class="space-y-4">
                    <div class="flex items-start space-x-3">
                        <div
                            class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center mt-0.5"
                        >
                            <span class="text-white text-xs font-bold">1</span>
                        </div>
                        <div>
                            <h4 class="font-semibold">
                                永远不要对主分支 force push
                            </h4>
                            <p class="text-gray-600 dark:text-gray-400">
                                主分支应该受到保护，避免直接 force push
                            </p>
                        </div>
                    </div>

                    <div class="flex items-start space-x-3">
                        <div
                            class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center mt-0.5"
                        >
                            <span class="text-white text-xs font-bold">2</span>
                        </div>
                        <div>
                            <h4 class="font-semibold">
                                只在自己的功能分支使用
                            </h4>
                            <p class="text-gray-600 dark:text-gray-400">
                                确保分支只有你在使用，避免影响其他开发者
                            </p>
                        </div>
                    </div>

                    <div class="flex items-start space-x-3">
                        <div
                            class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center mt-0.5"
                        >
                            <span class="text-white text-xs font-bold">3</span>
                        </div>
                        <div>
                            <h4 class="font-semibold">提前通知团队成员</h4>
                            <p class="text-gray-600 dark:text-gray-400">
                                如果必须 force push 共享分支，请提前通知相关人员
                            </p>
                        </div>
                    </div>
                </div>

                <h2>🔧 实用技巧</h2>

                <h3>配置 Git 别名</h3>
                <p>为了方便使用，可以设置 Git 别名：</p>
                <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-4 mb-4">
                    <code
                        >git config --global alias.pushf 'push
                        --force-with-lease'</code
                    >
                </div>
                <p>
                    之后就可以使用 <code>git pushf</code> 来安全地 force push。
                </p>

                <h3>检查脚本</h3>
                <p>创建一个脚本来自动化安全检查：</p>
                <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-4 mb-4">
                    <pre>#!/bin/bash
# safe-force-push.sh
BRANCH=$(git rev-parse --abbrev-ref HEAD)
if [ "$BRANCH" = "main" ] || [ "$BRANCH" = "master" ]; then
    echo "❌ 不能对主分支进行 force push!"
    exit 1
fi
echo "✅ 对分支 $BRANCH 进行安全 force push..."
git push --force-with-lease origin $BRANCH</pre>
                </div>

                <h2>🚨 紧急恢复</h2>

                <p>如果意外执行了错误的 force push，可以尝试以下恢复方法：</p>

                <h3>使用 Reflog</h3>
                <ol>
                    <li>查看操作历史：<code>git reflog</code></li>
                    <li>找到正确的提交：<code>git show HEAD@{"{n}"}</code></li>
                    <li>
                        重置到正确状态：<code
                            >git reset --hard HEAD@{"{n}"}</code>
                    </li>
                    <li>重新推送：<code>git push --force-with-lease</code></li>
                </ol>

                <h3>联系团队成员</h3>
                <p>如果其他人有本地副本，他们可以帮助恢复丢失的提交。</p>

                <h2>📋 最佳实践清单</h2>

                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6">
                    <h3
                        class="text-blue-900 dark:text-blue-100 font-semibold mb-4"
                    >
                        Force Push 检查清单
                    </h3>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" class="rounded" />
                            <span class="text-blue-800 dark:text-blue-200"
                                >确认在正确的分支上</span
                            >
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" class="rounded" />
                            <span class="text-blue-800 dark:text-blue-200"
                                >已拉取最新的远程代码</span
                            >
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" class="rounded" />
                            <span class="text-blue-800 dark:text-blue-200"
                                >确认没有其他人在该分支工作</span
                            >
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" class="rounded" />
                            <span class="text-blue-800 dark:text-blue-200"
                                >使用 --force-with-lease 而不是 --force</span
                            >
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" class="rounded" />
                            <span class="text-blue-800 dark:text-blue-200"
                                >已备份重要代码</span
                            >
                        </label>
                    </div>
                </div>

                <h2>🎉 总结</h2>

                <p>
                    Force push
                    是一个强大的工具，但需要谨慎使用。通过遵循本文的最佳实践，你可以安全地使用这个功能，
                    同时避免对团队协作造成负面影响。记住，安全第一，团队合作更重要！
                </p>

                <div
                    class="bg-green-50 dark:bg-green-900/20 rounded-lg p-6 mt-8"
                >
                    <h3
                        class="text-green-900 dark:text-green-100 font-semibold mb-2"
                    >
                        💡 记住这句话
                    </h3>
                    <p
                        class="text-green-800 dark:text-green-200 text-lg font-medium"
                    >
                        "With great power comes great responsibility"
                    </p>
                    <p class="text-green-700 dark:text-green-300 mt-2">
                        强大的功能需要负责任地使用 —— 这在 Git 中尤其如此。
                    </p>
                </div>
            </article>
        </main>

        <Footer />
    </body>
</html>
